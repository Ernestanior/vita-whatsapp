# 🗣️ 自然语言测试指南

**目的**: 全面测试系统对真实用户多变表达的理解能力  
**测试用例**: 360+ 种不同问法  
**覆盖功能**: 9 大类功能

---

## 📚 测试资源

### 1. 测试用例文档
**文件**: `NATURAL_LANGUAGE_TEST_CASES.md`

包含 12 个功能类别，每个类别 30-35 种不同问法：
- 查看连续打卡 (35 种)
- 预算管理 (35 种)
- 饮食偏好 (35 种)
- 查看统计 (35 种)
- 查看历史 (35 种)
- 查看/更新画像 (35 种)
- 寻求帮助 (35 种)
- 饮食建议 (35 种)
- 食物询问 (35 种)
- 闲聊/问候 (35 种)
- 目标相关 (35 种)
- 对比和进度 (35 种)

### 2. 自动化测试脚本
**文件**: `test-natural-language-comprehensive.mjs`

支持三种测试模式：
- 抽样测试：每类 10 个问法
- 全面测试：所有 360+ 个问法
- 单类测试：测试特定功能类别

---

## 🚀 快速开始

### 方式一：自动化测试（推荐）

#### 1. 抽样测试（快速验证）
```bash
node test-natural-language-comprehensive.mjs sample
```
- 测试时间：~5 分钟
- 测试数量：~90 个问法（每类 10 个）
- 适用场景：快速验证系统基本理解能力

#### 2. 全面测试（完整评估）
```bash
node test-natural-language-comprehensive.mjs full
```
- 测试时间：~30 分钟
- 测试数量：360+ 个问法
- 适用场景：全面评估系统理解能力

#### 3. 单类测试（针对性测试）
```bash
node test-natural-language-comprehensive.mjs streak
node test-natural-language-comprehensive.mjs budget
node test-natural-language-comprehensive.mjs preferences
```
- 测试时间：~3 分钟/类
- 测试数量：35 个问法/类
- 适用场景：针对特定功能深度测试

### 方式二：手动测试（真实体验）

打开 WhatsApp，从 `NATURAL_LANGUAGE_TEST_CASES.md` 中选择问法，逐个发送测试。

---

## 📊 评分标准

### 评分等级

| 分数 | 等级 | 说明 | 示例 |
|------|------|------|------|
| 5分 | ✅ 完美理解 | 准确识别意图，提供正确回复 | "我打卡多少天了" → 显示连续天数 |
| 4分 | ✅ 基本理解 | 识别意图，回复基本正确 | "我坚持了多久" → 显示连续信息 |
| 3分 | ⚠️ 部分理解 | 部分识别意图，回复不完全准确 | "我做得怎么样" → 显示部分相关信息 |
| 2分 | ⚠️ 误解 | 识别错误意图，回复不相关 | "我的进度" → 显示画像而非连续 |
| 1分 | ❌ 完全不理解 | 无法识别意图，回复"不理解" | "我坚持得咋样" → "我不明白" |

### 目标标准

- **优秀** 🏆: 90%+ 理解率（平均 4.5+ 分）
- **良好** 🥈: 80%+ 理解率（平均 4.0+ 分）
- **及格** 🥉: 70%+ 理解率（平均 3.5+ 分）
- **不及格** ❌: <70% 理解率（平均 <3.5 分）

---

## 📋 测试报告示例

```
📊 测试报告
============================================================

总测试数: 90
总得分: 378/450
平均分: 4.20/5
理解率: 84.0%

✅ 完美理解 (5分): 45 (50.0%)
✅ 基本理解 (4分): 30 (33.3%)
⚠️ 部分理解 (3分): 10 (11.1%)
⚠️ 误解 (2分): 3 (3.3%)
❌ 完全不理解 (1分): 2 (2.2%)

总体评级: 🥈 良好

❌ 完全不理解的案例 (2):
1. [streak] "我坚持得咋样"
   原因: 无法识别意图

2. [budget] "我吃撑了"
   原因: 无法识别意图

⚠️ 误解的案例 (3):
1. [streak] "我的进度如何"
   预期: streak, 检测到: profile

2. [budget] "我今天的情况"
   预期: budget, 检测到: stats

3. [preferences] "我的饮食习惯"
   预期: preferences, 检测到: stats

📊 按类别统计:

streak: 86.3% (151/175)
budget: 82.9% (145/175)
preferences: 88.0% (154/175)
stats: 80.0% (140/175)
history: 85.1% (149/175)
profile: 83.4% (146/175)
help: 90.3% (158/175)
advice: 81.7% (143/175)
greeting: 92.0% (161/175)
```

---

## 🔍 测试重点

### 1. 口语化表达
测试系统是否理解日常口语：
- "我打卡几天 lah"
- "我还能吃 meh"
- "我吃素的 leh"

### 2. 含糊不清的表达
测试系统是否能推理意图：
- "看看我的" → 应该问清楚要看什么
- "我做得怎么样" → 可能是连续、统计或进度
- "我今天的情况" → 可能是预算、统计或历史

### 3. 新加坡华语特色
测试系统是否适应本地表达：
- 语气词：lah, leh, lor, ah, sia, meh
- 混合语言：中英文混用
- 本地习惯：简化表达

### 4. 多变问法
同一意图的不同表达：
- 连续打卡：
  - "我打卡多少天了"
  - "连续几天了"
  - "我坚持了多久"
  - "我有没有断过"
  - "我的进度如何"

### 5. 情境理解
需要上下文的表达：
- "我还能吃吗" → 需要知道预算
- "我超了吗" → 需要知道预算和当前消耗
- "我会不会断了" → 需要知道连续和最后记录时间

---

## 🎯 改进建议

### 如果理解率 < 70%

1. **优化 AI 提示词**
   - 增加更多示例
   - 明确意图定义
   - 添加上下文理解

2. **增强关键词匹配**
   - 添加更多关键词
   - 支持模糊匹配
   - 处理拼写错误

3. **改进意图分类**
   - 细化意图类别
   - 添加意图优先级
   - 处理多意图情况

### 如果理解率 70-85%

1. **处理边界情况**
   - 含糊表达的澄清
   - 多意图的确认
   - 上下文的记忆

2. **优化回复质量**
   - 更自然的语言
   - 更准确的信息
   - 更友好的提示

### 如果理解率 > 85%

1. **持续优化**
   - 收集真实用户反馈
   - 分析失败案例
   - 迭代改进模型

2. **扩展功能**
   - 支持更多表达方式
   - 添加更多功能
   - 提升用户体验

---

## 📈 测试流程

### 第一阶段：基础测试（第 1 天）

1. **抽样测试**
   ```bash
   node test-natural-language-comprehensive.mjs sample
   ```
   
2. **分析结果**
   - 查看理解率
   - 识别问题类别
   - 记录失败案例

3. **快速修复**
   - 修复明显错误
   - 添加缺失关键词
   - 优化提示词

### 第二阶段：深度测试（第 2-3 天）

1. **单类测试**
   ```bash
   # 测试每个类别
   node test-natural-language-comprehensive.mjs streak
   node test-natural-language-comprehensive.mjs budget
   # ... 其他类别
   ```

2. **针对性优化**
   - 优化表现差的类别
   - 增强关键词匹配
   - 改进意图识别

3. **迭代测试**
   - 重新测试优化的类别
   - 验证改进效果
   - 记录改进前后对比

### 第三阶段：全面测试（第 4-5 天）

1. **完整测试**
   ```bash
   node test-natural-language-comprehensive.mjs full
   ```

2. **综合分析**
   - 整体理解率
   - 各类别表现
   - 失败案例分析

3. **最终优化**
   - 处理剩余问题
   - 优化边界情况
   - 提升整体质量

### 第四阶段：真实测试（第 6-7 天）

1. **手动测试**
   - 通过 WhatsApp 真实测试
   - 测试 50+ 个随机问法
   - 记录用户体验

2. **用户反馈**
   - 收集真实用户反馈
   - 识别实际使用问题
   - 优先处理高频问题

3. **持续改进**
   - 根据反馈优化
   - 添加新的表达方式
   - 提升用户满意度

---

## 🛠️ 故障排查

### 问题 1: API 错误

**症状**: 测试脚本报错 "API Error"

**解决**:
```bash
# 检查服务器是否运行
curl http://localhost:3000/api/test-ai-intent

# 检查环境变量
cat .env | grep OPENAI_API_KEY

# 重启服务器
npm run dev
```

### 问题 2: 理解率过低

**症状**: 理解率 < 50%

**可能原因**:
1. AI 模型未正确配置
2. 提示词不够清晰
3. 关键词匹配失效

**解决**:
1. 检查 `src/lib/ai/intent-detector.ts`
2. 检查 `src/lib/whatsapp/text-handler.ts`
3. 添加更多关键词

### 问题 3: 特定类别失败

**症状**: 某个类别理解率特别低

**解决**:
1. 单独测试该类别
2. 分析失败案例
3. 添加该类别的关键词
4. 优化该类别的提示词

---

## 📞 支持

### 需要帮助？

1. **查看文档**
   - `NATURAL_LANGUAGE_TEST_CASES.md` - 所有测试用例
   - `COMPREHENSIVE_PRODUCT_TEST_PLAN.md` - 整体测试计划

2. **运行诊断**
   ```bash
   # 测试 AI 意图识别
   node test-natural-language-comprehensive.mjs sample
   
   # 测试特定类别
   node test-natural-language-comprehensive.mjs streak
   ```

3. **检查日志**
   - Vercel 部署日志
   - 浏览器控制台
   - 测试脚本输出

---

## 🎉 总结

通过这套全面的自然语言测试：

1. ✅ **覆盖全面**: 360+ 种真实用户表达
2. ✅ **自动化**: 一键运行，快速反馈
3. ✅ **可量化**: 清晰的评分标准
4. ✅ **可追踪**: 详细的测试报告
5. ✅ **可改进**: 明确的优化方向

**目标**: 达到 85%+ 理解率，提供优秀的用户体验！

---

**开始测试**: `node test-natural-language-comprehensive.mjs sample`

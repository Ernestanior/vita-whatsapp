# Vita AI — 产品文档

## 项目概述

Vita AI 是一款基于 WhatsApp 的 AI 饮食健康助手，专注新加坡市场。用户通过 WhatsApp 发送食物照片、文字描述或语音消息，系统自动识别食物、分析营养成分、给出健康评分和个性化建议。

- 平台: WhatsApp Bot + Web Dashboard
- 目标市场: 新加坡
- 语言支持: 英文、简体中文、繁体中文
- 竞品参考: Cal AI, MyFitnessPal, Lose It!, SnapCalorie, FoodVisor, Yazio

---

## 一、用户旅程

### 1.1 首次使用（零门槛设计）

用户无需任何设置即可开始使用：

1. 用户在 WhatsApp 中搜索 Vita AI 并发送第一条消息
2. 系统发送欢迎消息，告知"直接发食物照片即可开始"
3. 用户发送食物照片 → 立即获得识别结果
4. 第5餐后，系统主动引导设置健康档案（可选）

**快速设置**: 用户只需发送三个数字 `25 170 65`（年龄 身高 体重），3秒完成基础设置。

**完整设置**: 多步骤引导式对话，依次收集身高、体重、年龄、性别、健康目标、活动水平。设置会话1小时过期，可随时输入 /help 取消。

### 1.2 日常使用流程

```
早上 → 收到早餐提醒（基于用户习惯时间提前15分钟）
     → 拍照/文字/语音记录早餐
     → 收到简洁结果：🟢 鸡蛋吐司 320kcal · 82/100 🔥3天连续 💰1480kcal剩余

午餐 → 不确定吃什么？发送"午餐吃什么好"
     → 系统根据今日已摄入量推荐合适的餐食

晚餐 → 拍照记录
     → 想看详细营养？点击"📊 详情"按钮

晚上 → 用户最后一餐后2-3小时，收到每日健康摘要
     → 包含总卡路里、营养分布、评分、建议

每周一 → 收到周报 + 卡路里趋势图表
```

---

## 二、核心功能

### 2.1 食物记录（三种方式）

| 方式 | 用户操作 | 系统处理 |
|------|---------|---------|
| 📸 拍照 | 发送食物照片 | AI视觉识别 → 自动记录 |
| ✏️ 文字 | 输入"午饭吃了鸡饭" | AI文字理解 → 估算营养 → 记录 |
| 🎤 语音 | 说"我刚吃了沙拉" | 语音转文字 → AI理解 → 记录 |

**关键交互设计**:
- 拍照即自动记录（无需确认），减少操作步骤
- 每次记录后显示三个按钮：[📊 详情] [✏️ 修改] [❌ 忽略]
- 默认返回简洁一行式结果，避免信息过载

### 2.2 健康评分

每次食物记录生成 0-100 分健康评分：

| 等级 | 分数 | 含义 |
|------|------|------|
| 🟢 绿灯 | ≥80 | 健康选择 |
| 🟡 黄灯 | 60-79 | 可以接受，有改善空间！ |
| 🔴 红灯 | <60 | 需要注意 |

评分考虑因素：
- 卡路里占每日目标的比例
- 钠含量（新加坡饮食普遍偏咸）
- 脂肪含量
- 营养均衡度（蛋白质/碳水/脂肪比例）
- Nutri-Grade 评级（新加坡特有的饮料营养等级）
- GI 升糖指数

评分根据用户健康目标个性化调整（减脂用户对卡路里更敏感，控糖用户对GI更敏感）。

### 2.3 餐前建议

用户发送"午餐吃什么好"/"what should I eat" 等类似问题时：
- 系统查询今日已记录的食物
- 计算剩余卡路里预算
- AI 生成个性化餐食推荐（考虑用户目标、偏好、已摄入营养）

这将 Vita AI 从被动记录工具转变为主动决策助手。

### 2.4 每日健康摘要

不再固定时间发送，而是在用户当天最后一餐后2-3小时智能发送：
- 总卡路里 vs 每日目标
- 三大营养素分布
- 当日平均健康评分
- 个性化改善建议
- 超标时推荐运动消耗方案（如"快走40分钟可消耗多余的200kcal"）

### 2.5 用餐提醒

基于用户实际饮食习惯（从 dietary_patterns 学习），在习惯用餐时间前15分钟发送提醒：
- 支持早餐、午餐、晚餐
- 尊重安静时段（默认 23:00-07:00 不打扰）
- 只提醒当天尚未记录的餐次

### 2.6 每周报告

每周一自动发送：
- 本周卡路里趋势图表（可视化图片）
- 记录天数和总餐数
- 平均每日卡路里
- 与目标的对比
- 下周改善建议

---

## 三、游戏化系统

### 3.1 连续打卡（核心保留）

- 每日记录至少一餐即算打卡
- 显示连续天数 + 历史最长记录
- 每周1次打卡冻结卡（防止意外断签）
- 里程碑：7天（一周战士）、30天（月度大师）、100天（百日冠军）

### 3.2 简化方向

原设计包含复杂的成就系统、排行榜、积分体系。当前决策是简化为：
- 保留连续打卡（用户粘性核心）
- 保留每周报告（替代复杂的进度追踪）
- 移除排行榜和积分系统（用户隐私顾虑 + 维护成本高）
- 已删除的 stub 功能：营养卡片生成、饮食对比引擎、定时提醒服务

---

## 四、个人健康档案

### 4.1 收集的数据

| 字段 | 范围 | 用途 |
|------|------|------|
| 身高 | 100-250cm | 计算BMR |
| 体重 | 30-300kg | 计算BMR |
| 年龄 | 10-120岁 | 计算BMR |
| 性别 | 男/女 | 计算BMR |
| 健康目标 | 减脂/增肌/控糖/维持 | 调整每日目标和评分权重 |
| 活动水平 | 久坐/轻度/中度/活跃 | 计算TDEE |

### 4.2 计算逻辑

BMR（基础代谢率）→ × 活动系数 → TDEE（每日总消耗）→ ± 目标调整 → 每日卡路里目标

目标调整：
- 减脂: TDEE - 500 kcal
- 增肌: TDEE + 300 kcal
- 控糖/维持: TDEE ± 0

---

## 五、订阅与商业模式

### 5.1 订阅层级

| 层级 | 月费 | 年费 | 每日识别 | 功能 |
|------|------|------|---------|------|
| Free | 免费 | — | 3次 | 基础识别 + 评分 |
| Premium | $9.90 | $99.00 | 无限 | + 每日摘要 + 历史 + 高级分析 |
| Pro | $19.90 | $199.00 | 无限 | + 优先支持 + 自定义报告 + 高级洞察 |

年付享约17%折扣。

### 5.2 付费转化触点

- 免费用户达到每日3次限额时，提示升级
- 每日摘要功能仅 Premium+ 可用
- 历史记录查看仅 Premium+ 可用

---

## 六、命令与交互

### 6.1 用户可用命令

| 命令 | 中文等价 | 说明 |
|------|---------|------|
| /start | 开始 | 重新开始引导流程 |
| /profile | 个人资料 | 查看/修改健康档案 |
| /help | 帮助 | 查看使用说明 |
| /stats | 统计 | 查看营养统计 |
| /history | 历史 | 查看饮食记录 |
| /settings | 设置 | 语言和偏好设置 |
| /streak | 打卡 | 查看连续打卡天数 |
| /budget | 预算 | 查看/设置每日卡路里预算 |

### 6.2 自然语言支持

用户不需要记住命令，可以用自然语言交流：
- "我想看看今天吃了什么" → 自动识别为查看历史
- "帮我统计一下这周的数据" → 自动识别为查看统计
- "午饭吃什么好" → 触发餐前建议
- "我刚吃了一碗面" → 触发文字食物记录

---

## 七、新加坡本地化

- 识别小贩中心（Hawker Centre）常见食物：鸡饭、叻沙、肉骨茶、椰浆饭等
- 支持 Nutri-Grade 评级（新加坡饮料营养标签制度）
- 食物名称同时显示英文和本地名称
- 响应风格友好专业，带轻微 Singlish 风味
- 钠含量特别关注（新加坡饮食普遍偏咸）

---

## 八、数据与隐私

- 所有数据存储在 Supabase (PostgreSQL)，启用行级安全策略
- 用户只能访问自己的数据
- WhatsApp Webhook 使用 HMAC SHA-256 签名验证
- 食物照片上传至 Supabase Storage，按用户隔离
- 不收集不必要的个人信息

---

## 九、当前状态与待办

### 已完成
- ✅ 图片食物识别 + 自动记录
- ✅ 文字食物记录
- ✅ 语音食物记录（Whisper）
- ✅ 健康评分系统
- ✅ 个人健康档案（快速设置 + 完整设置）
- ✅ 连续打卡系统
- ✅ 每日健康摘要（智能时间）
- ✅ 用餐提醒（基于习惯）
- ✅ 每周报告 + 趋势图表
- ✅ 餐前建议功能
- ✅ Stripe 订阅集成
- ✅ 配额管理
- ✅ 多语言支持
- ✅ 简洁响应格式 + 详情按钮
- ✅ 统一意图识别（单次AI调用，3→1优化）
- ✅ 代码清理（删除 2216 行冗余代码）

### 待优化
- ⏳ 配额检查当前为测试目的临时禁用
- ⏳ Web Dashboard 基础功能已有，需进一步完善
- ⏳ 数据导出功能（API已有，前端待对接）
- ⏳ Gemini API key 需重新生成（旧 key 已泄露标记）

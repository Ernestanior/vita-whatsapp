# 🧪 Vita WhatsApp Bot - 真实测试指南

**测试号码**: `+65 8315 3431`  
**状态**: 准备就绪，等待真实测试

---

## 📋 测试清单

### ✅ 已自动化测试（100% 通过）

这些功能已经通过自动化测试验证：

1. ✅ 数据库连接
2. ✅ 用户注册和创建
3. ✅ 健康画像保存
4. ✅ `/start` 命令
5. ✅ `/help` 命令
6. ✅ `/profile` 命令
7. ✅ 快速设置（3个数字）
8. ✅ 画像更新
9. ✅ 按钮交互
10. ✅ 并发消息处理
11. ✅ 错误恢复
12. ✅ 输入验证
13. ✅ 边界值测试
14. ✅ 语言检测（中文）
15. ✅ 响应时间（<500ms）
16. ✅ 数据库一致性
17. ✅ 命令中断处理
18. ✅ 无效输入处理

### 🟡 需要真实测试的功能

这些功能代码已完成，但需要真实 WhatsApp 消息测试：

1. 🟡 **图片识别** - 发送食物照片
2. 🟡 **营养分析** - 查看分析结果
3. 🟡 **健康评分** - 绿/黄/红灯系统
4. 🟡 **个性化建议** - 基于目标的建议
5. 🟡 **Progressive Profiling** - 第2张和第5张照片后的提示
6. 🟡 **目标选择按钮** - 选择健康目标
7. 🟡 **配额管理** - 免费用户每天3次限制
8. 🟡 **新加坡英语** - Singlish 风格消息
9. 🟡 **本地食物识别** - 鸡饭、叻沙等

---

## 🧪 测试步骤

### Phase 1: 基础功能测试（5分钟）

#### 测试 1: 欢迎消息
```
发送: /start
预期: 收到欢迎消息和按钮
```

#### 测试 2: 快速设置
```
发送: 25 170 65
预期: 收到确认消息，显示 BMI 和目标
```

#### 测试 3: 查看画像
```
发送: /profile
预期: 显示完整的健康画像信息
```

#### 测试 4: 帮助命令
```
发送: /help
预期: 显示帮助信息和操作按钮
```

#### 测试 5: 中文命令
```
发送: 帮助
预期: 显示中文帮助信息
```

---

### Phase 2: 图片识别测试（10分钟）

#### 测试 6: 发送食物照片
```
操作: 拍摄或发送一张食物照片
预期: 
1. 立即收到 "📸 Got your photo! Analyzing..." 
2. 10秒内收到分析结果
3. 显示食物名称、营养成分、健康评分
4. 显示个性化建议
5. 显示操作按钮（记录/修改/忽略）
```

#### 测试 7: 新加坡本地食物
```
操作: 发送鸡饭、叻沙、或其他本地食物照片
预期: 
1. 识别出本地食物名称
2. 使用新加坡英语风格回复
3. 例如: "Wah, chicken rice! Singapore's favorite! 🍗🍚"
```

#### 测试 8: 第2张照片 - Progressive Profiling
```
操作: 发送第2张食物照片
预期: 
1. 正常分析食物
2. 分析后收到提示：询问是否要设置画像
3. 提示格式：3个数字（年龄 身高 体重）
```

#### 测试 9: 第5张照片 - 目标选择
```
操作: 发送第5张食物照片
预期: 
1. 正常分析食物
2. 分析后收到目标选择提示
3. 显示4个按钮：减脂/增肌/控糖/维持
```

---

### Phase 3: 高级功能测试（10分钟）

#### 测试 10: 配额限制
```
操作: 发送第4张照片（免费用户限制3次/天）
预期: 
1. 收到配额超限消息
2. 提示升级到 Premium
3. 告知明天可以继续使用
```

#### 测试 11: 按钮交互
```
操作: 点击分析结果后的按钮
预期: 
1. "记录" - 保存到数据库
2. "修改" - 允许修改识别结果
3. "忽略" - 不保存记录
```

#### 测试 12: 目标选择
```
操作: 点击目标选择按钮（1-4）
预期: 
1. 更新用户目标
2. 收到确认消息
3. 后续建议会根据新目标调整
```

#### 测试 13: 画像更新
```
发送: 30 175 70
预期: 
1. 更新画像信息
2. 收到新的 BMI 和目标
3. 数据库正确更新
```

#### 测试 14: 并发消息
```
操作: 快速连续发送多条消息
预期: 
1. 所有消息都被处理
2. 按顺序收到回复
3. 没有消息丢失
```

#### 测试 15: 错误恢复
```
发送: 随机乱码文本
预期: 
1. 收到友好的错误提示
2. 提供帮助建议
3. 系统保持稳定
```

---

## 📊 测试结果记录

### 基础功能测试结果

| 测试 | 状态 | 备注 |
|------|------|------|
| 1. 欢迎消息 | ⏳ 待测试 | |
| 2. 快速设置 | ⏳ 待测试 | |
| 3. 查看画像 | ⏳ 待测试 | |
| 4. 帮助命令 | ⏳ 待测试 | |
| 5. 中文命令 | ⏳ 待测试 | |

### 图片识别测试结果

| 测试 | 状态 | 备注 |
|------|------|------|
| 6. 食物照片 | ⏳ 待测试 | |
| 7. 本地食物 | ⏳ 待测试 | |
| 8. 第2张照片 | ⏳ 待测试 | |
| 9. 第5张照片 | ⏳ 待测试 | |

### 高级功能测试结果

| 测试 | 状态 | 备注 |
|------|------|------|
| 10. 配额限制 | ⏳ 待测试 | |
| 11. 按钮交互 | ⏳ 待测试 | |
| 12. 目标选择 | ⏳ 待测试 | |
| 13. 画像更新 | ⏳ 待测试 | |
| 14. 并发消息 | ⏳ 待测试 | |
| 15. 错误恢复 | ⏳ 待测试 | |

---

## 🐛 问题追踪

### 发现的问题

| # | 问题描述 | 严重程度 | 状态 | 备注 |
|---|---------|---------|------|------|
| - | 暂无 | - | - | - |

---

## 📝 测试注意事项

### 重要提示

1. **OpenAI API Key**: 确保 `.env` 中配置了有效的 OpenAI API key
2. **图片质量**: 使用清晰的食物照片，光线充足
3. **网络连接**: 确保 WhatsApp 和服务器网络稳定
4. **测试数据**: 测试后可以清理数据库中的测试记录

### 查看日志

测试时可以实时查看日志：
```bash
vercel logs --follow
```

或访问 Vercel Dashboard 查看详细日志。

### 数据库检查

测试后检查 Supabase 数据库：
1. 打开 Supabase Dashboard
2. 查看 `users` 表 - 应该有测试用户记录
3. 查看 `health_profiles` 表 - 应该有画像数据
4. 查看 `food_records` 表 - 应该有食物记录（如果发送了照片）
5. 查看 `usage_quotas` 表 - 应该有配额记录

---

## 🎯 成功标准

### 基础功能（必须100%通过）
- ✅ 所有命令正常响应
- ✅ 快速设置成功保存
- ✅ 画像显示正确
- ✅ 按钮交互正常
- ✅ 错误处理友好

### 图片识别（目标80%以上准确率）
- 🎯 食物识别准确
- 🎯 营养计算合理
- 🎯 健康评分正确
- 🎯 建议个性化
- 🎯 响应时间<15秒

### 用户体验（主观评价）
- 😊 消息友好自然
- 😊 新加坡英语地道
- 😊 操作简单直观
- 😊 反馈及时清晰
- 😊 整体体验流畅

---

## 🚀 测试完成后

### 如果所有测试通过
1. ✅ 标记为生产就绪
2. ✅ 开始 Beta 测试
3. ✅ 邀请真实用户
4. ✅ 收集反馈
5. ✅ 持续优化

### 如果发现问题
1. 🐛 记录问题详情
2. 🐛 评估严重程度
3. 🐛 修复关键问题
4. 🐛 重新测试
5. 🐛 更新文档

---

**测试负责人**: 你（用户）  
**测试时间**: 现在  
**预计耗时**: 25分钟  
**测试环境**: 生产环境（WhatsApp）

**准备好了吗？开始测试吧！** 🚀

# Vita AI 健身人群优化方案

## 背景

当前 Vita AI 是一个通用饮食记录工具，面向所有人。本方案将产品重新聚焦到健身人群，通过针对性的功能调优，解决他们最核心的痛点：**快速准确地追踪宏量营养素（蛋白质 + 碳水）**。

健身人群的特点：
- 已有记录习惯（从 MFP 等工具迁移），不需要教育市场
- 最关心蛋白质和碳水摄入量，其次是总卡路里
- 付费意愿强（已在补剂、私教、健身房上花钱）
- 新加坡健身社群活跃（CrossFit、F45、Anytime Fitness），天然传播网络

---

## 一、响应格式优化（蛋白质 + 碳水前置）

### 现状
```
🟢 鸡饭 520kcal · 82/100 🔥3天连续 💰1480kcal剩余
```

### 优化后
```
🟢 鸡饭 520kcal · P32g · C58g · 82/100
🔥3天 💪 P: 78/150g · C: 142/250g · 💰980kcal剩余
```

### 改动点
- `response-formatter-sg.ts` 的 `formatResponse()` 方法
- 在卡路里后面紧跟蛋白质和碳水克数（P32g · C58g）
- 新增每日宏量进度：`💪 P: 已摄入/目标g · C: 已摄入/目标g`
- 蛋白质目标 = 体重(kg) × 系数（增肌2.0，减脂1.8，维持1.5）
- 碳水目标 = 根据剩余卡路里和蛋白质/脂肪分配自动计算
- 详情页增加 P/C/F 三大营养素占比百分比

### 涉及文件
- `src/lib/whatsapp/response-formatter-sg.ts`
- `src/lib/digest/daily-digest-generator.ts`（摘要也要前置蛋白质和碳水）

---

## 二、健康评分权重调整（健身模式）

### 现状权重
| 因素 | 权重 |
|------|------|
| 卡路里 | 25% |
| 钠 | 20% |
| 脂肪 | 15% |
| 营养均衡 | 15% |
| Nutri-Grade | 15% |
| GI | 10% |

### 健身模式权重
| 因素 | 增肌 | 减脂 | 维持 |
|------|------|------|------|
| 蛋白质达标率（新增） | 25% | 20% | 15% |
| 碳水达标率（新增） | 10% | 15% | 10% |
| 卡路里 | 15% | 25% | 25% |
| 营养均衡(P/C/F) | 25% | 15% | 15% |
| 钠 | 10% | 10% | 15% |
| 脂肪 | 5% | 10% | 10% |
| Nutri-Grade | 5% | 5% | 5% |
| GI | 5% | 0% | 5% |

### 关键变化
- 新增"蛋白质达标率"因素：单餐蛋白质 vs 该餐应摄入量
- 新增"碳水达标率"因素：减脂模式下碳水超标会扣分，增肌模式下碳水不足会扣分
- 增肌模式：碳水不惩罚反而鼓励（训练需要碳水），蛋白质权重最高
- 减脂模式：卡路里权重最高，碳水超标惩罚更重，蛋白质其次（防止掉肌肉）
- GI 对增肌用户几乎不重要（训练后高GI反而有利）

### 涉及文件
- `src/lib/rating/rating-engine.ts` — `calculateOverallScore()` 方法
- 新增蛋白质和碳水评分因素的计算逻辑

---

## 三、用户档案扩展（健身字段）

### 现有 goal 选项
`'lose-weight' | 'gain-muscle' | 'control-sugar' | 'maintain'`

### 新增字段
```typescript
// health_profiles 表新增
training_type?: 'bulk' | 'cut' | 'maintain' | 'recomp';  // 训练阶段
protein_target?: number;     // 自定义蛋白质目标(g)，默认按体重计算
carb_target?: number;        // 自定义碳水目标(g)，默认按训练阶段计算
activity_level?: 'sedentary' | 'light' | 'moderate' | 'active' | 'very_active';
```

### 宏量营养素目标自动计算
```
                蛋白质(g/kg体重)    碳水(g/kg体重)    脂肪
bulk（增肌期）:    2.0               4-6              剩余卡路里
cut（减脂期）:     1.8               2-3              剩余卡路里
maintain（维持）:  1.5               3-4              剩余卡路里
recomp（重组）:    1.8               3-4              剩余卡路里
```

用户也可以手动覆盖：发送"蛋白质目标 180g"或"碳水目标 250g"即可自定义。

### 涉及文件
- `src/lib/database/schema.ts`
- `src/types/database.ts`
- Supabase migration（新增列）
- `src/lib/ai/unified-intent-detector.ts`（识别"蛋白质目标"/"碳水目标"意图）

---

## 四、餐前建议优化（宏量营养素缺口导向）

### 现状
用户问"午饭吃什么好" → 系统根据剩余卡路里推荐

### 优化后
```
你今天还差 62g 蛋白质、108g 碳水，剩余 850kcal 预算

推荐：
🥩 鸡胸饭（少油）— P38g · C52g · 450kcal
🐟 清蒸鱼片饭 — P35g · C48g · 380kcal
🥚 温泉蛋 + 豆腐 — P22g · C5g · 180kcal（加餐）

💡 碳水还有空间，可以正常吃饭，重点补蛋白质
```

### 改动点
- 餐前建议的 AI prompt 增加蛋白质和碳水缺口信息
- 推荐食物时展示蛋白质和碳水含量
- 根据剩余宏量营养素缺口给出具体建议（不只是卡路里）
- 减脂用户碳水快超标时提醒"少饭多菜"；增肌用户碳水不足时提醒"可以多吃点饭"
- 推荐新加坡本地高蛋白选择（鸡胸、鱼片、豆腐、蛋）

### 涉及文件
- `src/lib/ai/unified-intent-detector.ts`（MEAL_ADVICE handler）
- 餐前建议的 prompt 模板（需传入 P/C 缺口数据）

---

## 五、每日摘要优化（宏量营养素报告）

### 现状摘要
```
📊 今日总结
总卡路里: 1850 / 2000 kcal
健康评分: 78/100
建议: ...
```

### 优化后
```
📊 今日总结 · 3餐 · 78/100

🔥 1850 / 2000 kcal (92%)
💪 蛋白质: 128 / 150g ✅ (85%)
🍚 碳水: 220 / 250g ✅ (88%)
🧈 脂肪: 58g

宏量分布:
  早 P18g C45g → 午 P52g C98g → 晚 P58g C77g
  ⚠️ 早餐蛋白质偏低，建议加个鸡蛋

🏃 今天多摄入了 150kcal，快走25分钟可消耗
```

### 关键变化
- 蛋白质和碳水各单独一行 + 进度百分比 + 达标标记
- 新增宏量分布分析（三餐 P/C 分布是否均匀）
- 脂肪简洁展示（不设硬目标，展示总量即可）
- 保留运动消耗建议

### 涉及文件
- `src/lib/digest/daily-digest-generator.ts`

---

## 六、周报优化（宏量营养素趋势）

### 现状
- 一张卡路里柱状图 + 文字摘要

### 优化后
- 图表1: 每日卡路里柱状图（保留）
- 图表2: 每日蛋白质 + 碳水达标率折线图（新增）
- 文字摘要增加:
  - 平均每日蛋白质 / 碳水摄入
  - 蛋白质达标天数 / 7、碳水达标天数 / 7
  - 本周 vs 上周宏量营养素趋势
  - 最佳蛋白质来源 Top 3（从记录中统计）

### 可分享卡片（社交货币）
```
🏋️ Vita AI 周报
━━━━━━━━━━━━━━
📅 本周记录 21 餐
💪 日均蛋白质 142g (目标150g)
🍚 日均碳水 238g (目标250g)
🔥 连续打卡 12 天
🟢 健康率 76%
━━━━━━━━━━━━━━
#VitaAI #MealPrep
```

设计成适合 IG Story 分享的竖版图片（1080×1920），用 QuickChart.io 生成。

### 涉及文件
- `src/app/api/cron/weekly-trend/route.ts`
- QuickChart 配置（新增蛋白质 + 碳水图表）

---

## 七、新增意图：快速记录蛋白质补剂

### 场景
健身人群经常喝蛋白粉、吃蛋白棒，这些不适合拍照。

### 交互
```
用户: "一勺蛋白粉"
系统: ✅ 乳清蛋白 120kcal · P25g · 已记录
      💪 P: 103/150g · 💰1380kcal剩余
```

### 实现
- 在 AI 食物识别 prompt 中增加常见补剂的营养数据
- 蛋白粉（一勺约25g蛋白质/120kcal）
- 蛋白棒（约20g蛋白质/200kcal）
- BCAA（约0卡/0蛋白质，但记录训练行为）
- Creatine（5g/0卡，记录即可）

### 涉及文件
- `src/lib/ai/food-recognition.ts`（prompt 增加补剂知识）

---

## 八、新加坡健身人群饮食场景分析

新加坡健身人群的饮食不是"堂食 vs 减脂餐"二选一，而是两种场景混合存在。产品需要同时覆盖。

### 场景一：Hawker Centre 改良派（占多数）

这群人不会放弃小贩中心，而是掌握了"点餐技巧"：
- 鸡饭去皮、少饭加菜
- 鱼汤不要炸鱼，要清蒸/水煮
- 杂菜饭多选蛋白质（豆腐、鸡蛋、蒸鱼）
- Yong Tau Foo 自选高蛋白配料
- 经济米粉汤底代替干捞

痛点：不是"找不到吃的"，而是"不确定这样点到底多少蛋白质和碳水"。

Vita 的价值：拍一张改良版鸡饭，告诉他们 P32g · C45g，比原版好多少。

#### 食物识别优化
- 识别"去皮鸡饭"和"普通鸡饭"的营养差异
- 识别"少饭"、"加菜"、"不要酱"等修饰词并调整营养估算
- 杂菜饭 / Yong Tau Foo 的逐项识别（多配料组合）
- 常见改良点餐的蛋白质对比提示（"去皮省了 8g 脂肪，蛋白质不变 👍"）

### 场景二：Meal Prep / 减脂餐派

新加坡近年涌现的品牌：
- Yolo Foods、Grain、Fitthree、The Lean Bento
- 各种 Telegram 群团购的 meal prep
- 自己在家 meal prep（周日煮一周的鸡胸）

特点：餐食营养数据通常已标好（盒子上印着 P35g C40g F12g）。

Vita 的价值：
- 快速扫一下确认/录入数据
- 追踪一天总量（早餐 meal prep + 午餐外食的混合场景）
- 周维度的宏量趋势分析

#### 食物识别优化
- 识别包装上的营养标签（OCR 读取 P/C/F）
- 常见品牌快速录入（"Yolo 鸡胸饭" 直接匹配已知数据）
- 支持手动输入宏量（"午餐 P35 C40 F12" 直接记录，不需要 AI 估算）

### 场景三：补剂（低频但重要）

已在第七章覆盖。补充：
- 常见品牌识别（ON Gold Standard、MyProtein、Dymatize）
- "一勺蛋白粉" → 自动按 25g protein / 120kcal 计算
- 蛋白棒品牌匹配（Quest、Kirkland、Barebells 在新加坡常见）

### 对食物识别 Prompt 的影响

需要在 `food-recognition.ts` 的 prompt 中增加：
1. 新加坡 hawker 改良点餐的识别能力（修饰词 → 营养调整）
2. Meal prep 品牌数据库（本地品牌 → 已知营养数据）
3. 手动宏量输入的解析（"P35 C40 F12" 格式）
4. 补剂品牌 → 标准营养数据映射

### 涉及文件
- `src/lib/ai/food-recognition.ts`（prompt 增强）
- `src/lib/ai/unified-intent-detector.ts`（识别手动宏量输入意图）
- 未来可考虑：本地品牌营养数据库（JSON/Supabase 表）

---

## 九、实施优先级

### P0 — 立即做（影响最大，改动最小）
1. **响应格式加蛋白质 + 碳水** — 改 formatter，1-2小时
2. **健康评分权重按目标调整** — 改 rating-engine，2-3小时
3. **每日摘要加蛋白质 + 碳水进度** — 改 digest generator，1-2小时
4. **Hawker 修饰词识别** — 改 food-recognition prompt，识别"去皮/少饭/加菜"等修饰词并调整营养估算，1-2小时

### P1 — 本周做
5. **用户档案扩展** — 加字段 + migration，2小时
6. **蛋白质 + 碳水目标自动计算** — 基于体重和训练阶段，1小时
7. **餐前建议加宏量缺口** — 改 prompt，传入 P/C 缺口，1-2小时
8. **补剂快速记录** — 改 food recognition prompt，1小时
9. **手动宏量输入** — 支持 "午餐 P35 C40 F12" 格式直接记录，2小时

### P2 — 下周做
10. **周报蛋白质 + 碳水趋势图** — 新增 QuickChart 配置，3-4小时
11. **可分享周报卡片** — QuickChart 竖版模板，2-3小时
12. **蛋白质分布分析**（三餐均匀度）— 2小时
13. **本地 Meal Prep 品牌数据库** — Yolo Foods/Grain/Fitthree 等已知营养数据，3-4小时

---

## 十、不做的事情

- ❌ 不做训练记录（不是我们的核心，让 Strong/Hevy 做）
- ❌ 不做卡路里计算器（用户自己算，我们只追踪实际摄入）
- ❌ 不做社交功能/排行榜（隐私顾虑，维护成本高）
- ❌ 不做食谱推荐（太重，且有大量竞品）
- ❌ 不改变 WhatsApp 为主的交互方式（这是我们的优势）

---

## 十一、成功指标

| 指标 | 当前基线 | 目标 |
|------|---------|------|
| 日均记录餐数/用户 | 待测量 | ≥2.5餐 |
| 7日留存率 | 待测量 | ≥40% |
| 30日留存率 | 待测量 | ≥20% |
| 付费转化率 | 待测量 | ≥5% |
| 周报分享率 | 0（无此功能） | ≥10% |

---

## 十二、技术注意事项

1. 蛋白质目标计算依赖用户体重 — 未设置体重的用户使用默认值（男120g/女90g）
2. 评分权重切换需要知道用户 goal — 未设置 goal 的用户使用"maintain"默认权重
3. QuickChart.io 免费版有速率限制 — 周报生成需要错峰（现有 cron 已是凌晨跑）
4. 补剂营养数据相对标准化，不需要视觉识别，纯文字即可准确估算
